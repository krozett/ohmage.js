!function(e,r){"function"==typeof define&&define.amd?define(["jquery","jquery.cookie"],r):"object"==typeof exports?module.exports=r(require("jquery","jquery.cookie")):e.returnExports=r(jQuery)}(this,function(e){Ohmage=function(r,n){function t(e,r,n){var t,a,u,c,o,s=function(){return(new Date).getTime()},i=function(){var l=s()-c;r>l?t=setTimeout(i,r-l):(t=null,n||(o=e.apply(u,a),u=a=null))};return function(){u=this,a=arguments,c=s();var l=n&&!t;return t||(t=setTimeout(i,r)),l&&(o=e.apply(u,a),u=a=null),o}}function a(e){var r,n=!1;return function(){return n?r:(n=!0,r=e.apply(this,arguments),e=null,r)}}if(!r||!n)throw"app and client are required parameters.";r=r.replace(/\/+$/,"");var u=[],c={};return c.callback=function(e,r){return u.push({name:e,fun:r}),c},c.call=function(t,a,c){function o(r,n,t){t.status&&e.each(s,function(e,a){a(r,n,t)})}var s=[],c=c||function(e){return e.data},a=a||{};a.client=n,e.cookie("auth_token")&&(a.auth_token=e.cookie("auth_token"));var i={type:"POST",url:r+t,data:a,dataType:"text",xhrFields:{withCredentials:!0}};a instanceof FormData&&(i.contentType=!1,i.cache=!1,i.processData=!1);var l=e.ajax(i).then(function(r,n,a){var u=e.Deferred();if("application/json"==a.getResponseHeader("content-type")){if(!r||""==r){var s="Fail: "+t+". Ohmage returned undefined error.";o(s,-1,a),u.reject(a,n,s)}var i=e.parseJSON(r);if("success"==i.result)u.resolve(c(i),n,a);else if("failure"==i.result){var s=i.errors[0].text;o(i.errors[0].text,i.errors[0].code,a),u.reject(a,n,s)}else{o(s,-2,a),u.reject(a,n,s)}}else u.resolve(r,n,a);return u.promise()},function(r,n,t){var a=e.Deferred();return r.status&&o("HTTP "+r.status+": "+r.responseText,-3,r),a.reject(r,n,t),a.promise()});return l.error=function(e){return s.push(function(r,n,t){return e(r,n,t),l}),l},e.each(u,function(e,r){l[r.name](r.fun)}),l},c.callform=function(r,t,a){var u=new FormData;return u.append("client",n),u.append("auth_token",e.cookie("auth_token")),e.each(t,function(e,r){u.append(e,r)}),c.call(r,u,a)},c.config={},c.user={},c["class"]={},c.campaign={},c.document={},c.registration={},c.audit={},c.survey={},c.response={},c.config.read=function(){return c.call("/config/read")},c.user.whoami=function(){return c.call("/user/whoami",{},function(e){return e.username})},c.user.auth_token=function(e){return c.call("/user/auth_token",e,function(e){return e.token})},c.login=function(e,r){return c.user.auth_token({user:e,password:r})},c.user.logout=function(){return c.call("/user/logout")},c.user.info=function(){return c.call("/user_info/read")},c.user.read=function(e){return c.call("/user/read",e)},c.user.setup=function(e){return c.call("/user/setup",e)},c.user.change_password=function(e){return c.call("/user/change_password",e)},c.user.reset_password=function(e){return c.call("/user/reset_password",e)},c.user.activate=function(e){return c.call("/user/activate",e)},c.user["delete"]=function(e){return c.call("/user/delete",e)},c.user.search=function(e){return c.call("/user/search",e)},c.user.create=function(e){return c.call("/user/create",e)},c.user.update=function(e){return c.call("/user/update",e)},c["class"].read=function(e){return c.call("/class/read",e)},c["class"].create=function(e){return c.call("/class/create",e)},c["class"]["delete"]=function(e){return c.call("/class/delete",e)},c["class"].update=function(e){return c.call("/class/update",e)},c["class"].adduser=function(e,r){return c["class"].update({class_urn:e,user_role_list_add:r})},c["class"].removeuser=function(e,r){return c["class"].update({class_urn:e,user_list_remove:r})},c["class"].search=function(e){return c.call("/class/search",e)},c.campaign.read=function(e){return e=e||{},e.output_format=e.output_format||"short",c.call("/campaign/read",e,function(e){return e.metadata.items})},c.campaign.create=function(e){return c.call("/campaign/create",e)},c.campaign.update=function(e){return c.call("/campaign/update",e)},c.campaign.addclass=function(e,r){return c.campaign.update({campaign_urn:e,class_list_add:r})},c.campaign["delete"]=function(e){return c.call("/campaign/delete",e)},c.campaign.search=function(e){return c.call("/campaign/search",e)},c.campaign.readall=function(e){return e=e||{},e.output_format=e.output_format||"short",c.call("/campaign/read",e)},c.document.create=function(e){return c.call("/document/create",e,function(e){return e.document_id})},c.document.read=function(e){return c.call("/document/read",e)},c.document.search=function(e){return c.document.read({document_name_search:e})},c.document.contents=function(e){return c.call("/document/read/contents",e)},c.document["delete"]=function(e){return c.call("/document/delete",e)},c.document.update=function(e){return c.call("/document/update",e)},c.registration.read=function(){return c.call("/registration/read")},c.user.register=function(e){return c.call("/user/register",e)},c.audit.read=function(e){return c.call("/audit/read",e,function(e){return e.audits})},c.survey.count=function(e){return data={campaign_urn:e,id:"privacy_state"},c.call("/survey_response/function/read",data)},c.response.read=function(e){return c.call("/survey_response/read",{campaign_urn:e,column_list:"urn:ohmage:special:all",output_format:"json-rows",survey_id_list:"urn:ohmage:special:all",user_list:"urn:ohmage:special:all"})},c.response.read_custom=function(e){return e=e||{},e.column_list=e.column_list||"urn:ohmage:special:all",e.output_format=e.output_format||"json-rows",e.survey_id_list=e.survey_id_list||"urn:ohmage:special:all",e.user_list=e.user_list||"urn:ohmage:special:all",c.call("/survey_response/read",e)},c.response["delete"]=function(e,r){return c.call("/survey_response/delete",{campaign_urn:e,survey_key:r})},c.response.update=function(e,r,n){return c.call("/survey_response/update",{campaign_urn:e,survey_key:r,privacy_state:n?"shared":"private"})},c.ping=t(c.user.whoami,6e4,!0),c.keepalive=a(function(e){e=e||60,setInterval(c.ping,1e3*e)}),c.keepactive=a(function(r){e("html").click(function(){c.ping()})};