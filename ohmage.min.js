function Ohmage(e,n){function r(e,n,r){var t,a,u,c,s,o=function(){return(new Date).getTime()},i=function(){var l=o()-c;n>l?t=setTimeout(i,n-l):(t=null,r||(s=e.apply(u,a),u=a=null))};return function(){u=this,a=arguments,c=o();var l=r&&!t;return t||(t=setTimeout(i,n)),l&&(s=e.apply(u,a),u=a=null),s}}function t(e){var n,r=!1;return function(){return r?n:(r=!0,n=e.apply(this,arguments),e=null,n)}}if(!e||!n)throw"app and client are required parameters.";e=e.replace(/\/+$/,"");var a=[],u={};return u.callback=function(e,n){return a.push({name:e,fun:n}),u},u.call=function(r,t,u){function c(e,n,r){r.status&&$.each(s,function(t,a){a(e,n,r)})}var s=[],u=u||function(e){return e.data},t=t||{};t.client=n,$.cookie("auth_token")&&(t.auth_token=$.cookie("auth_token"));var o={type:"POST",url:e+r,data:t,dataType:"text",xhrFields:{withCredentials:!0}};t instanceof FormData&&(o.contentType=!1,o.cache=!1,o.processData=!1);var i=$.ajax(o).then(function(e,n,t){var a=$.Deferred();if("application/json"==t.getResponseHeader("content-type")){if(!e||""==e){var s="Fail: "+r+". Ohmage returned undefined error.";c(s,-1,t),a.reject(t,n,s)}var o=$.parseJSON(e);if("success"==o.result)a.resolve(u(o),n,t);else if("failure"==o.result){var s=o.errors[0].text;c(o.errors[0].text,o.errors[0].code,t),a.reject(t,n,s)}else{c(s,-2,t),a.reject(t,n,s)}}else a.resolve(e,n,t);return a.promise()},function(e,n,r){var t=$.Deferred();return e.status&&c("HTTP "+e.status+": "+e.responseText,-3,e),t.reject(e,n,r),t.promise()});return i.error=function(e){return s.push(function(n,r,t){return e(n,r,t),i}),i},$.each(a,function(e,n){i[n.name](n.fun)}),i},u.callform=function(e,r,t){var a=new FormData;return a.append("client",n),a.append("auth_token",$.cookie("auth_token")),$.each(r,function(e,n){a.append(e,n)}),u.call(e,a,t)},u.config={},u.user={},u["class"]={},u.campaign={},u.document={},u.registration={},u.audit={},u.survey={},u.response={},u.config.read=function(){return u.call("/config/read")},u.user.whoami=function(){return u.call("/user/whoami",{},function(e){return e.username})},u.user.auth_token=function(e){return u.call("/user/auth_token",e,function(e){return e.token})},u.login=function(e,n){return u.user.auth_token({user:e,password:n})},u.user.logout=function(){return u.call("/user/logout")},u.user.info=function(){return u.call("/user_info/read")},u.user.read=function(e){return u.call("/user/read",e)},u.user.setup=function(e){return u.call("/user/setup",e)},u.user.change_password=function(e){return u.call("/user/change_password",e)},u.user.reset_password=function(e){return u.call("/user/reset_password",e)},u.user.activate=function(e){return u.call("/user/activate",e)},u.user["delete"]=function(e){return u.call("/user/delete",e)},u.user.search=function(e){return u.call("/user/search",e)},u.user.create=function(e){return u.call("/user/create",e)},u.user.update=function(e){return u.call("/user/update",e)},u["class"].read=function(e){return u.call("/class/read",e)},u["class"].create=function(e){return u.call("/class/create",e)},u["class"]["delete"]=function(e){return u.call("/class/delete",e)},u["class"].update=function(e){return u.call("/class/update",e)},u["class"].adduser=function(e,n){return u["class"].update({class_urn:e,user_role_list_add:n})},u["class"].removeuser=function(e,n){return u["class"].update({class_urn:e,user_list_remove:n})},u["class"].search=function(e){return u.call("/class/search")},u.campaign.read=function(e){return e=e||{},e.output_format=e.output_format||"short",u.call("/campaign/read",e,function(e){return e.metadata.items})},u.campaign.create=function(e){return u.call("/campaign/create",e)},u.campaign.update=function(e){return u.call("/campaign/update",e)},u.campaign.addclass=function(e,n){return u.campaign.update({campaign_urn:e,class_list_add:n})},u.campaign["delete"]=function(e){return u.call("/campaign/delete",e)},u.campaign.search=function(e){return u.call("/campaign/search",e)},u.campaign.readall=function(e){return e=e||{},e.output_format=e.output_format||"short",u.call("/campaign/read",e)},u.document.create=function(e){return u.call("/document/create",e,function(e){return e.document_id})},u.document.read=function(e){return u.call("/document/read",e)},u.document.search=function(e){return u.document.read({document_name_search:e})},u.document.contents=function(e){return u.call("/document/read/contents",e)},u.document["delete"]=function(e){return u.call("/document/delete",e)},u.document.update=function(e){return u.call("/document/update",e)},u.registration.read=function(){return u.call("/registration/read")},u.user.register=function(e){return u.call("/user/register",e)},u.audit.read=function(e){return u.call("/audit/read",e,function(e){return e.audits})},u.survey.count=function(e){return data={campaign_urn:e,id:"privacy_state"},u.call("/survey_response/function/read",data)},u.response.read=function(e){return u.call("/survey_response/read",{campaign_urn:e,column_list:"urn:ohmage:special:all",output_format:"json-rows",survey_id_list:"urn:ohmage:special:all",user_list:"urn:ohmage:special:all"})},u.response["delete"]=function(e,n){return u.call("/survey_response/delete",{campaign_urn:e,survey_key:n})},u.response.update=function(e,n,r){return u.call("/survey_response/update",{campaign_urn:e,survey_key:n,privacy_state:r?"shared":"private"})},u.ping=r(u.user.whoami,6e4,!0),u.keepalive=t(function(e){e=e||60,setInterval(u.ping,1e3*e)}),u.keepactive=t(function(e){$("html").click(function(){u.ping()})}),u.config.read().done(function(e){console.log("This is Ohmage/"+e.application_name+" "+e.application_version+" ("+e.application_build+")")}).error(function(e,n){console.log("Ohmage seems offline: "+e)}),u}